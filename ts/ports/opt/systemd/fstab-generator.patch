--- src/fstab-generator/fstab-generator.c.orig	2018-06-22 11:11:49.000000000 +0000
+++ src/fstab-generator/fstab-generator.c	2018-10-04 00:18:52.788544697 +0000
@@ -79,6 +79,17 @@
         return 1;
 }
 
+static int write_condition(FILE *f, const char *what) {
+        _cleanup_free_ char *w = NULL;
+
+        w = specifier_escape(what);
+        if (!w)
+                return log_oom();
+
+        fprintf(f, "ConditionPathExists=%s\n", w);
+        return 1;
+}
+
 static int add_swap(
                 const char *what,
                 struct mntent *me,
@@ -111,8 +122,13 @@
 
         fputs("# Automatically generated by systemd-fstab-generator\n\n"
               "[Unit]\n"
-              "SourcePath=/etc/fstab\n"
-              "Documentation=man:fstab(5) man:systemd-fstab-generator(8)\n\n"
+              "SourcePath=/etc/fstab\n", f);
+
+        r = write_condition(f, what);
+        if (r < 0)
+                return r;
+
+        fputs("Documentation=man:fstab(5) man:systemd-fstab-generator(8)\n\n"
               "[Swap]\n", f);
 
         r = write_what(f, what);
@@ -461,6 +477,10 @@
                         "Documentation=man:fstab(5) man:systemd-fstab-generator(8)\n",
                         source);
 
+                r = write_condition(f, what);
+                if (r < 0)
+                        return r;
+
                 fprintf(f, "Before=%s\n", post);
 
                 if (opts) {
--- src/fstab-generator/fstab-generator.c.orig	2018-10-04 00:46:18.499845696 +0000
+++ src/fstab-generator/fstab-generator.c	2018-10-04 00:46:50.067025076 +0000
@@ -128,6 +128,8 @@
         if (r < 0)
                 return r;
 
+        fprintf(f, "After=systemd-udev-settle.service\n");
+
         fputs("Documentation=man:fstab(5) man:systemd-fstab-generator(8)\n\n"
               "[Swap]\n", f);
 
@@ -482,6 +484,7 @@
                         return r;
 
                 fprintf(f, "Before=%s\n", post);
+                fprintf(f, "After=systemd-udev-settle.service\n");
 
                 if (opts) {
                         r = write_after(f, opts);
